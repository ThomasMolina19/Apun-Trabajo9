<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>La guerra, la paz: el lenguaje hecho realidad</title>
  <meta name="description" content="P√°gina interactiva sobre c√≥mo el lenguaje puede ser un arma o un puente hacia la paz y el papel de la memoria." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&family=Playfair+Display:wght@700;900&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg: #0a0e1a;
      --bg-secondary: #0f1421;
      --panel: #151b2e;
      --panel-hover: #1a2138;
      --muted: #8b92ab;
      --text: #e8eaf0;
      --text-bright: #ffffff;
      --brand: #10b981;
      --brand-dark: #059669;
      --brand-light: #34d399;
      --brand-2: #3b82f6;
      --brand-2-light: #60a5fa;
      --accent: #f59e0b;
      --accent-light: #fbbf24;
      --warn: #ef4444;
      --warn-dark: #dc2626;
      --ok: #10b981;
      --ring: #2d3548;
      --ring-bright: #3d4663;
      --card: #0d1220;
      --shadow: 0 20px 60px rgba(0,0,0,.4);
      --shadow-lg: 0 30px 80px rgba(0,0,0,.5);
      --radius: 20px;
      --radius-sm: 12px;
      --glow-brand: 0 0 30px rgba(16,185,129,.2);
      --glow-warn: 0 0 30px rgba(239,68,68,.2);
    }

    @media (prefers-color-scheme: light){
      :root{
        --bg: #f5f7fa;
        --bg-secondary: #ffffff;
        --panel: #ffffff;
        --panel-hover: #f9fafb;
        --muted: #6b7280;
        --text: #1f2937;
        --text-bright: #111827;
        --brand: #059669;
        --brand-dark: #047857;
        --brand-light: #10b981;
        --brand-2: #2563eb;
        --brand-2-light: #3b82f6;
        --accent: #d97706;
        --accent-light: #f59e0b;
        --warn: #dc2626;
        --warn-dark: #b91c1c;
        --ring: #e5e7eb;
        --ring-bright: #d1d5db;
        --card: #ffffff;
        --shadow: 0 10px 40px rgba(0,0,0,.08);
        --shadow-lg: 0 20px 60px rgba(0,0,0,.12);
        --glow-brand: 0 0 30px rgba(16,185,129,.15);
        --glow-warn: 0 0 30px rgba(239,68,68,.15);
      }
    }

    .high-contrast{
      --bg: #000;
      --panel: #111;
      --muted: #fff;
      --text: #fff;
      --brand: #0ff;
      --brand-2: #ff0;
      --accent: #f0f;
      --ring: #fff;
      --card: #000;
      --shadow: none;
      --glow-brand: none;
      --glow-warn: none;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    html { 
      height: 100%; 
      scroll-behavior: smooth;
    }
    
    body{
      min-height: 100%;
      margin:0; 
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      background: 
        radial-gradient(circle at 20% 10%, rgba(16,185,129,.08) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(59,130,246,.08) 0%, transparent 50%),
        radial-gradient(circle at 40% 80%, rgba(245,158,11,.05) 0%, transparent 50%),
        var(--bg);
      background-attachment: fixed;
      color: var(--text);
      line-height:1.7;
      overflow-x: hidden;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    .container{
      max-width:1200px; 
      margin:0 auto; 
      padding: 32px 24px;
    }
    
    @media (max-width: 768px) {
      .container { padding: 20px 16px; }
    }

    a{
      color: var(--brand-2-light);
      text-decoration: none;
      transition: color .2s;
    }
    a:hover { color: var(--brand-light); }
    
    .skip{
      position:absolute; 
      left:-9999px;
      background: var(--panel);
      padding: 12px 20px;
      border-radius: var(--radius-sm);
      color: var(--text-bright);
      font-weight: 600;
    }
    .skip:focus{
      left:20px; 
      top:20px; 
      outline: 3px solid var(--brand-2);
      z-index: 1000;
    }

    header{
      position: sticky; 
      top:0; 
      z-index:100; 
      backdrop-filter: blur(16px) saturate(180%);
      background: color-mix(in srgb, var(--bg) 85%, transparent);
      border-bottom: 1px solid var(--ring);
      box-shadow: 0 4px 20px rgba(0,0,0,.1);
    }

    .bar{
      display:flex; 
      align-items:center; 
      gap:20px; 
      justify-content:space-between; 
      padding:20px 32px;
      flex-wrap: wrap;
    }
    
    .title{
      font-family: 'Playfair Display', serif;
      font-weight:900; 
      font-size: 1.3rem;
      letter-spacing:.3px;
      color: var(--text-bright);
    }
    
    .tag{
      font-size:.85rem; 
      color:var(--muted);
      line-height: 1.5;
    }

    .actions{
      display:flex; 
      gap:10px;
      flex-wrap: wrap;
    }
    
    .btn{
      appearance:none; 
      border:none; 
      border-radius:999px; 
      padding:12px 20px; 
      cursor:pointer; 
      color:var(--text); 
      background:var(--panel);
      outline:1px solid var(--ring); 
      box-shadow: var(--shadow);
      font-weight: 600;
      font-size: .9rem;
      transition: all .3s cubic-bezier(0.4, 0, 0.2, 1);
      font-family: 'Inter', sans-serif;
      line-height: 1.5;
    }
    
    .btn:hover{
      outline-color: var(--brand-2);
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(0,0,0,.15);
      background: var(--panel-hover);
    }
    
    .btn:active{
      transform: translateY(0);
    }
    
    .btn.primary{
      background: linear-gradient(135deg, var(--brand), var(--brand-dark));
      color: white;
      outline: none;
      font-weight: 700;
    }
    
    .btn.primary:hover{
      background: linear-gradient(135deg, var(--brand-light), var(--brand));
      box-shadow: var(--glow-brand);
    }

    main{
      display:grid; 
      gap:40px;
      padding-bottom: 60px;
    }

    .hero{
      display:grid; 
      gap:24px; 
      padding: 60px 40px;
      border-radius: var(--radius); 
      background: 
        linear-gradient(135deg, 
          color-mix(in srgb, var(--brand) 5%, transparent),
          color-mix(in srgb, var(--brand-2) 5%, transparent)
        ),
        var(--panel);
      box-shadow: var(--shadow-lg);
      border: 1px solid var(--ring);
      position: relative;
      overflow: hidden;
    }
    
    .hero::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--brand), var(--brand-2), var(--accent));
    }
    
    .hero h1{
      font-family: 'Playfair Display', serif;
      font-size: clamp(2rem, 5vw, 3.5rem); 
      font-weight: 900;
      margin:0;
      line-height: 1.2;
      color: var(--text-bright);
    }
    
    .hero p{
      color:var(--muted); 
      margin:.5rem 0 0;
      font-size: 1.15rem;
      max-width: 800px;
      line-height: 1.8;
    }
    
    .hero .stats {
      display: flex;
      gap: 30px;
      margin-top: 20px;
      flex-wrap: wrap;
    }
    
    .hero .stat {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }
    
    .hero .stat-number {
      font-size: 2rem;
      font-weight: 900;
      color: var(--brand);
    }
    
    .hero .stat-label {
      font-size: .85rem;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .grid{
      display:grid; 
      grid-template-columns: repeat(auto-fit, minmax(320px,1fr)); 
      gap:24px;
    }
    
    @media (max-width: 768px) {
      .grid { grid-template-columns: 1fr; }
    }
    
    .card{
      background: var(--card); 
      border:1px solid var(--ring); 
      border-radius: var(--radius); 
      padding:28px; 
      box-shadow: var(--shadow);
      transition: all .3s ease;
      position: relative;
    }
    
    .card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-lg);
      border-color: var(--ring-bright);
    }
    
    .card h2, .card h3{
      margin:0 0 16px 0;
      font-family: 'Playfair Display', serif;
      font-weight: 700;
      color: var(--text-bright);
      line-height: 1.3;
    }
    
    .card h2 { font-size: 1.75rem; }
    .card h3 { font-size: 1.4rem; }

    .tabs{
      display:flex; 
      gap:12px; 
      flex-wrap:wrap;
      margin-bottom: 20px;
    }
    
    .tab{
      flex:1; 
      min-width:200px; 
      padding:18px 24px; 
      border-radius: var(--radius-sm); 
      border:2px solid var(--ring); 
      background:var(--panel); 
      cursor:pointer; 
      text-align:center;
      font-weight: 600;
      transition: all .3s ease;
      font-size: 1.05rem;
      color: var(--text);
      line-height: 1.6;
    }
    
    .tab:hover {
      border-color: var(--ring-bright);
      background: var(--panel-hover);
      color: var(--text-bright);
    }
    
    .tab[aria-selected="true"]{
      background: linear-gradient(135deg, var(--brand), var(--brand-dark));
      border-color: var(--brand);
      color: #ffffff;
      box-shadow: var(--glow-brand);
      font-weight: 700;
    }

    .pill{
      display:inline-flex; 
      align-items:center; 
      gap:10px; 
      padding:10px 16px; 
      border-radius:999px; 
      background: color-mix(in srgb, var(--brand) 10%, transparent); 
      border:1px solid var(--ring); 
      font-size:.95rem;
      font-weight: 600;
      line-height: 1.5;
    }
    
    .pill.warn{
      background: color-mix(in srgb, var(--warn) 10%, transparent);
      border-color: color-mix(in srgb, var(--warn) 30%, transparent);
    }

    .examples{
      display:grid; 
      gap:14px;
      margin-top: 20px;
    }
    
    .ex{
      display:grid; 
      gap:8px; 
      padding:16px 20px; 
      border-radius: var(--radius-sm); 
      background: var(--panel); 
      border:1px solid var(--ring);
      transition: all .2s;
    }
    
    .ex:hover {
      border-color: var(--ring-bright);
      background: var(--panel-hover);
    }
    
    .ex strong {
      color: var(--brand-light);
      font-weight: 700;
      display: inline-block;
    }
    
    .ex small{
      color:var(--muted);
      line-height: 1.6;
    }

    .tool{
      display:grid; 
      gap:16px;
    }
    
    textarea, input, select{
      width:100%; 
      padding:14px 18px; 
      border-radius: var(--radius-sm); 
      background: var(--panel); 
      color: var(--text);
      border:2px solid var(--ring); 
      outline-offset:2px;
      font-family: 'Inter', sans-serif;
      font-size: 1rem;
      transition: all .2s;
    }
    
    textarea:focus, input:focus, select:focus {
      border-color: var(--brand-2);
      background: var(--panel-hover);
      outline: none;
    }
    
    textarea {
      resize: vertical;
      min-height: 120px;
    }
    
    .controls{
      display:flex; 
      gap:12px; 
      flex-wrap:wrap;
    }
    
    .controls .btn.secondary{
      background: var(--panel);
    }
    
    .controls .btn.secondary:hover {
      background: var(--panel-hover);
    }

    .out{
      padding:20px; 
      border-radius: var(--radius-sm); 
      background: var(--panel); 
      border:2px solid var(--ring);
      min-height: 100px;
      line-height: 1.8;
      font-size: 1.05rem;
    }
    
    .hl{
      background: color-mix(in srgb, var(--brand-2) 25%, transparent); 
      border-radius:6px; 
      padding:2px 6px;
      font-weight: 600;
      border: 1px solid color-mix(in srgb, var(--brand-2) 40%, transparent);
    }
    
    details {
      margin-top: 16px;
      padding: 16px;
      background: var(--panel);
      border: 1px solid var(--ring);
      border-radius: var(--radius-sm);
    }
    
    details summary {
      cursor: pointer;
      font-weight: 600;
      color: var(--brand-light);
      padding: 8px 0;
    }
    
    details[open] summary {
      margin-bottom: 12px;
      padding-bottom: 12px;
      border-bottom: 1px solid var(--ring);
    }

    .cols{
      display:grid; 
      grid-template-columns: repeat(auto-fit, minmax(280px,1fr)); 
      gap:20px;
    }
    
    .col h4{
      margin:0 0 12px 0;
      font-family: 'Playfair Display', serif;
      font-size: 1.3rem;
      color: var(--text-bright);
    }
    
    .memo-item{
      display:flex; 
      gap:14px; 
      align-items:flex-start; 
      padding:16px; 
      border-radius: var(--radius-sm); 
      border:2px solid var(--ring); 
      background: var(--panel);
      transition: all .2s;
      margin-bottom: 12px;
    }
    
    .memo-item:hover {
      transform: translateX(4px);
      border-color: var(--ring-bright);
    }
    
    .memo-item .icon {
      font-size: 1.5rem;
      line-height: 1;
    }
    
    .memo-item .tag{
      font-size:.8rem;
      margin-top: 4px;
    }
    
    .memo-item.good{
      border-color: var(--ok);
      background: color-mix(in srgb, var(--ok) 5%, var(--panel));
    }
    
    .memo-item.bad{
      border-color: var(--warn);
      background: color-mix(in srgb, var(--warn) 5%, var(--panel));
    }
    
    .memo-item.good:hover {
      box-shadow: var(--glow-brand);
    }
    
    .memo-item.bad:hover {
      box-shadow: var(--glow-warn);
    }

    .empty{
      color:var(--muted); 
      font-style:italic;
      padding: 20px;
      text-align: center;
    }

    .gloss li{
      margin: 12px 0;
      padding-left: 8px;
      line-height: 1.8;
    }
    
    .gloss li strong {
      color: var(--brand-light);
      font-weight: 700;
      display: inline-block;
    }
    
    ul {
      padding-left: 24px;
    }
    
    ul li {
      margin: 10px 0;
      line-height: 1.7;
    }
    
    ul li strong {
      display: inline-block;
    }

    footer{
      color:var(--muted); 
      font-size:.95rem; 
      border-top:1px solid var(--ring); 
      padding:40px 0;
      text-align: center;
      margin-top: 40px;
    }
    
    footer code {
      background: var(--panel);
      padding: 4px 8px;
      border-radius: 6px;
      color: var(--brand-light);
      font-size: .9rem;
    }
    
    .quote {
      border-left: 4px solid var(--brand);
      padding: 20px 24px;
      margin: 20px 0;
      background: var(--panel);
      border-radius: 0 var(--radius-sm) var(--radius-sm) 0;
      font-style: italic;
      color: var(--muted);
    }
    
    .badge {
      display: inline-block;
      padding: 6px 12px;
      border-radius: 999px;
      font-size: .8rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: .5px;
    }
    
    .badge.success {
      background: color-mix(in srgb, var(--ok) 20%, transparent);
      color: var(--ok);
    }
    
    .badge.warning {
      background: color-mix(in srgb, var(--warn) 20%, transparent);
      color: var(--warn);
    }
    
    .badge.info {
      background: color-mix(in srgb, var(--brand-2) 20%, transparent);
      color: var(--brand-2);
    }

    @media (prefers-reduced-motion: no-preference){
      .fade-in{
        opacity:0; 
        transform: translateY(20px); 
        animation: fade .6s cubic-bezier(0.4, 0, 0.2, 1) .1s forwards;
      }
      
      .fade-in:nth-child(2) { animation-delay: .2s; }
      .fade-in:nth-child(3) { animation-delay: .3s; }
      .fade-in:nth-child(4) { animation-delay: .4s; }
      
      @keyframes fade{
        to{
          opacity:1; 
          transform:none;
        }
      }
      
      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateX(-20px);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }
    }
    
    @media (max-width: 768px) {
      .hero { padding: 40px 24px; }
      .hero h1 { font-size: 2rem; }
      .bar { padding: 16px 20px; }
      .title { font-size: 1.1rem; }
      .card { padding: 20px; }
    }
  </style>
</head>
<body>
  <a class="skip" href="#contenido">Saltar al contenido</a>
  <header>
    <div class="bar container" role="navigation" aria-label="Barra superior">
      <div>
        <div class="title">La guerra, la paz: el lenguaje hecho realidad</div>
        <div class="tag">¬øC√≥mo puede el lenguaje ser <strong>arma</strong> o <strong>puente</strong>, y qu√© papel juega la <strong>memoria</strong>?</div>
      </div>
      <div class="actions">
        <button id="contrastBtn" class="btn" aria-pressed="false" title="Alternar alto contraste">Alto contraste</button>
        <button id="resetBtn" class="btn" title="Reiniciar datos guardados">Reiniciar</button>
      </div>
    </div>
  </header>

  <main class="container" id="contenido">

    <section class="hero fade-in" aria-labelledby="intro-h">
      <h1 id="intro-h">Lenguaje que hiere, lenguaje que repara</h1>
      <p>Las palabras no son neutras. Pueden justificar la violencia o abrir caminos de cuidado. Tambi√©n guardan memoria: lo que repetimos, olvidamos o contamos cambia la forma en que una comunidad se mira a s√≠ misma.</p>
    </section>

    <section class="grid" aria-labelledby="tabs-h">
      <div class="card fade-in">
        <h2 id="tabs-h" style="margin-top:0">Dos caras del lenguaje</h2>
        <div class="tabs" role="tablist" aria-label="Modos del lenguaje">
          <button role="tab" class="tab" id="t-arma" aria-selected="true" aria-controls="p-arma">‚ö†Ô∏è Lenguaje como arma</button>
          <button role="tab" class="tab" id="t-puente" aria-selected="false" aria-controls="p-puente">ü§ù Lenguaje como puente</button>
        </div>
        <div id="p-arma" role="tabpanel" aria-labelledby="t-arma" style="margin-top:12px">
          <p class="pill warn">Se√±ales: deshumanizaci√≥n, rumores, etiquetas que reducen a las personas.</p>
          <div class="examples" aria-live="polite">
            <div class="ex"><strong>Generalizaci√≥n:</strong> ‚ÄúEllos <em>siempre</em> son violentos‚Äù. <small>Reduce y niega la diversidad interna de un grupo.</small></div>
            <div class="ex"><strong>Deshumanizaci√≥n:</strong> ‚ÄúSon ratas / plaga‚Äù. <small>Facilita justificar da√±os.</small></div>
            <div class="ex"><strong>Rumor como verdad:</strong> ‚ÄúDicen que nos van a atacar‚Äù. <small>Afirma sin evidencia.</small></div>
          </div>
        </div>
        <div id="p-puente" role="tabpanel" aria-labelledby="t-puente" hidden style="margin-top:12px">
          <p class="pill">Claves: reconocimiento, precisi√≥n, empat√≠a y responsabilidad.</p>
          <div class="examples" aria-live="polite">
            <div class="ex"><strong>Reconocer el da√±o:</strong> ‚ÄúLo que ocurri√≥ fue injusto; lamento mi parte‚Äù.</div>
            <div class="ex"><strong>Nombrar con cuidado:</strong> ‚ÄúPersonas afectadas por el conflicto‚Äù, no ‚Äúcolaterales‚Äù.</div>
            <div class="ex"><strong>Buscar evidencia:</strong> ‚Äú¬øCu√°l es la fuente? Contrastemos‚Äù.</div>
          </div>
        </div>
      </div>

      <div class="card fade-in">
        <h2 style="margin-top:0">Taller: reescribe en clave de paz</h2>
        <div class="tool">
          <label for="texto">Pega una frase o p√°rrafo. El asistente sugiere cambios de lenguaje que cuidan. <span class="tag">Funciona localmente, sin internet.</span></label>
          <textarea id="texto" rows="6" placeholder="Ej.: Esa gente es una plaga; hay que sacarlos como sea."></textarea>
          <div class="controls">
            <button id="rewriteBtn" class="btn">Reescribir</button>
            <button id="copyBtn" class="btn secondary">Copiar salida</button>
          </div>
          <div class="out" id="salida" aria-live="polite">La versi√≥n cuidada aparecer√° aqu√≠.</div>
          <details>
            <summary>Mapa de reemplazos (transparencia)</summary>
            <p class="tag">La herramienta usa sustituciones simples para promover lenguaje preciso y humano. Puedes editar el mapa dentro del c√≥digo si lo deseas.</p>
            <ul id="mapList" class="tag"></ul>
          </details>
        </div>
      </div>
    </section>

    <section class="card fade-in" aria-labelledby="mem-h">
      <h2 id="mem-h" style="margin-top:0">Memoria que hiere y memoria que sana</h2>
      <p>La memoria no es solo recordar: es elegir c√≥mo contar. Para no repetir, hace falta una memoria que nombre los hechos con cuidado y que incluya las voces de quienes sufrieron.</p>
      <form id="memoForm" class="grid" aria-label="Agregar recuerdo">
        <div>
          <label for="memoText">¬øQu√© recuerdo quieres registrar?</label>
          <input id="memoText" type="text" required placeholder="Ej.: Escuch√© a mi familia usar apodos deshumanizantes" />
        </div>
        <div>
          <label for="memoType">Marca el tipo</label>
          <select id="memoType">
            <option value="bad">Hiere</option>
            <option value="good">Sana</option>
          </select>
        </div>
        <div>
          <label for="memoWho">¬øQui√©n lo dijo o a qui√©n?</label>
          <input id="memoWho" type="text" placeholder="Ej.: Profesor, chat, noticiero‚Ä¶" />
        </div>
        <div>
          <label for="memoWhen">¬øCu√°ndo?</label>
          <input id="memoWhen" type="date" />
        </div>
        <div style="align-self:end">
          <button class="btn" type="submit">Guardar en mi cuaderno</button>
        </div>
      </form>

      <div class="cols" style="margin-top:12px">
        <div>
          <h4>Registros que hieren</h4>
          <div id="listBad" class="stack" role="list">
            <p class="empty">A√∫n no hay registros.</p>
          </div>
        </div>
        <div>
          <h4>Registros que sanan</h4>
          <div id="listGood" class="stack" role="list">
            <p class="empty">A√∫n no hay registros.</p>
          </div>
        </div>
      </div>
      <div class="controls" style="margin-top:10px">
        <button id="exportBtn" class="btn secondary" title="Descarga un archivo .json con tus registros">Exportar cuaderno (.json)</button>
      </div>
    </section>

    <section class="grid" aria-labelledby="gloss-h">
      <div class="card">
        <h2 id="gloss-h" style="margin-top:0">Mini glosario b√°sico</h2>
        <ul class="gloss">
          <li><strong>Paz negativa:</strong> ausencia de guerra abierta, pero con injusticias y miedo.</li>
          <li><strong>Paz positiva:</strong> presencia de derechos, di√°logo y condiciones para una vida digna.</li>
          <li><strong>Deshumanizaci√≥n:</strong> tratar a personas como cosas o plagas, para justificar da√±o.</li>
          <li><strong>Memoria colectiva:</strong> relato compartido de lo ocurrido; cambia seg√∫n qui√©n habla y c√≥mo.</li>
        </ul>
      </div>
      <div class="card">
        <h2 style="margin-top:0">Gu√≠a r√°pida para hablar con cuidado</h2>
        <ul>
          <li>Nombra a las personas por lo que <em>hacen</em> y <em>viven</em>, no por etiquetas fijas.</li>
          <li>Pide fuentes y contrasta; si dudas, dilo.</li>
          <li>Separa la cr√≠tica de la persona: cuestiona ideas y acciones, no su humanidad.</li>
          <li>Reconoce tu propio sesgo y, si te equivocas, corrige en p√∫blico.</li>
        </ul>
      </div>
    </section>

    <footer class="container">
      Hecho por Thomas Molina Molina <code>Para Catedra Apun 50 a√±os</code>‚ú®
    </footer>
  </main>

  <script>
    // -------- Utilidades de interfaz --------
    const $ = (sel, el=document) => el.querySelector(sel);
    const $$ = (sel, el=document) => Array.from(el.querySelectorAll(sel));

    // Alto contraste
    const contrastBtn = $('#contrastBtn');
    contrastBtn.addEventListener('click', () => {
      const pressed = contrastBtn.getAttribute('aria-pressed') === 'true';
      contrastBtn.setAttribute('aria-pressed', String(!pressed));
      document.documentElement.classList.toggle('high-contrast');
      localStorage.setItem('high-contrast', document.documentElement.classList.contains('high-contrast') ? '1' : '0');
    });
    if(localStorage.getItem('high-contrast') === '1'){
      document.documentElement.classList.add('high-contrast');
      contrastBtn.setAttribute('aria-pressed', 'true');
    }

    // Tabs arma/puente accesibles
    const tabs = $$('.tab');
    const panels = [$('#p-arma'), $('#p-puente')];
    tabs.forEach((t, i)=>{
      t.addEventListener('click', ()=>activateTab(i));
      t.addEventListener('keydown', (e)=>{
        if(e.key==='ArrowRight') activateTab((i+1)%tabs.length);
        if(e.key==='ArrowLeft') activateTab((i-1+tabs.length)%tabs.length);
      });
    });
    function activateTab(i){
      tabs.forEach((t,j)=> t.setAttribute('aria-selected', String(i===j)) );
      panels.forEach((p,j)=> p.hidden = i!==j );
    }

    // -------- Taller: reescritura en clave de paz --------
    const mapa = [
      ['plaga','personas que piensan distinto'],
      ['ratas','personas'],
      ['exterminar','superar'],
      ['traidores','personas disidentes'],
      ['odi(\w*)','rechaz$1'],
      ['radical(es)?','personas con ideas extremas'],
      ['ellos','la otra parte'],
      ['enemigo(s)?','parte contraria'],
      ['limpiar el barrio','mejorar la convivencia del barrio'],
      ['mano dura','justicia que respete derechos'],
      ['c√°llate','te escucho y luego respondo'],
      ['guerra','conflicto'],
      ['vencer','llegar a un acuerdo mejor'],
      ['vagos','personas sin empleo'],
      ['ilegales','personas en condici√≥n irregular'],
      ['fan√°ticos','seguidores muy comprometidos'],
      ['locos','personas con sufrimiento mental']
    ];

    // Mostrar el mapa de reemplazos
    const mapList = $('#mapList');
    mapa.forEach(([a,b])=>{ const li=document.createElement('li'); li.textContent = `"${a}" ‚Üí "${b}"`; mapList.appendChild(li); });

    const txt = $('#texto');
    const out = $('#salida');
    const rewriteBtn = $('#rewriteBtn');
    const copyBtn = $('#copyBtn');

    rewriteBtn.addEventListener('click', ()=>{
      const src = txt.value.trim();
      if(!src){ out.textContent = 'Escribe o pega un texto arriba.'; return; }
      let res = src;
      const highlights = [];
      mapa.forEach(([a,b])=>{
        const re = new RegExp(`\\b${a}\\b`, 'gi');
        res = res.replace(re, (m)=>{ highlights.push(m); return b; });
      });
      // Se√±alar cambios
      let shown = res;
      highlights.forEach(h=>{
        const reh = new RegExp(h.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g');
        shown = shown.replace(reh, `<span class="hl" title="Reemplazo sugerido">${h}</span>`);
      });
      out.innerHTML = shown;
    });

    copyBtn.addEventListener('click', async ()=>{
      const tmp = document.createElement('div');
      tmp.innerHTML = out.innerHTML.replace(/<[^>]+>/g,'');
      const plain = tmp.textContent;
      try{ await navigator.clipboard.writeText(plain); copyBtn.textContent='Copiado'; setTimeout(()=>copyBtn.textContent='Copiar salida', 1200); }catch{ alert('No se pudo copiar.'); }
    });

    // -------- Cuaderno de memoria (localStorage) --------
    const memoForm = $('#memoForm');
    const listGood = $('#listGood');
    const listBad = $('#listBad');
    const KEY = 'memoria-cuaderno-v1';

    function loadMemo(){
      try{ return JSON.parse(localStorage.getItem(KEY) || '[]'); }catch{ return []; }
    }
    function saveMemo(items){ localStorage.setItem(KEY, JSON.stringify(items)); }

    function renderMemo(){
      const items = loadMemo();
      listGood.innerHTML = ''; listBad.innerHTML='';
      const good = items.filter(i=>i.type==='good');
      const bad  = items.filter(i=>i.type==='bad');
      if(bad.length===0) listBad.innerHTML = '<p class="empty">A√∫n no hay registros.</p>';
      if(good.length===0) listGood.innerHTML = '<p class="empty">A√∫n no hay registros.</p>';
      for(const it of bad) listBad.appendChild(cardMemo(it, 'bad'));
      for(const it of good) listGood.appendChild(cardMemo(it, 'good'));
    }

    function cardMemo(it, cls){
      const el = document.createElement('article');
      el.className = `memo-item ${cls}`; el.setAttribute('role','listitem');
      el.innerHTML = `
        <div>${cls==='good'?'üïäÔ∏è':'‚ö†Ô∏è'}</div>
        <div>
          <div><strong>${escapeHtml(it.text)}</strong></div>
          <div class="tag">${it.who?('De/para: '+escapeHtml(it.who)+' ¬∑ '):''}${it.when||'Sin fecha'}</div>
        </div>
        <div style="margin-left:auto; display:flex; gap:6px">
          <button class="btn secondary" title="Eliminar" aria-label="Eliminar">Eliminar</button>
        </div>`;
      el.querySelector('button').addEventListener('click', ()=>{
        const all = loadMemo();
        const rest = all.filter(x=>x.id!==it.id);
        saveMemo(rest); renderMemo();
      });
      return el;
    }

    function escapeHtml(s){ return s.replace(/[&<>"']/g, c=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[c])); }

    memoForm.addEventListener('submit', (e)=>{
      e.preventDefault();
      const text = $('#memoText').value.trim();
      if(!text) return;
      const type = $('#memoType').value;
      const who  = $('#memoWho').value.trim();
      const when = $('#memoWhen').value || new Date().toISOString().slice(0,10);
      const items = loadMemo();
      items.push({ id: String(Date.now())+Math.random(), text, type, who, when });
      saveMemo(items); memoForm.reset(); renderMemo();
    });

    const exportBtn = $('#exportBtn');
    exportBtn.addEventListener('click', ()=>{
      const data = JSON.stringify(loadMemo(), null, 2);
      const blob = new Blob([data], {type:'application/json'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'cuaderno-memoria.json';
      a.click();
      URL.revokeObjectURL(a.href);
    });

    const resetBtn = $('#resetBtn');
    resetBtn.addEventListener('click', ()=>{
      if(confirm('Esto borrar√° el cuaderno local y restablecer√° la vista. ¬øContinuar?')){
        localStorage.removeItem(KEY);
        localStorage.removeItem('high-contrast');
        document.documentElement.classList.remove('high-contrast');
        renderMemo();
      }
    });

    renderMemo();
  </script>
</body>
</html>

